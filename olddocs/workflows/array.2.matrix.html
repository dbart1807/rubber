

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>make matrices from microarray gffs &mdash; rage 1.0 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="rage 1.0 documentation" href="../index.html"/>
        <link rel="prev" title="mat.ops" href="../functions/mat.ops.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../index.html" class="fa fa-home"> rage</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div> 
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul>
<li class="toctree-l1"><a class="reference internal" href="../installation/index.html"><em>Installation</em></a><ul>
<li class="toctree-l2"><a class="reference internal" href="../installation/index.html#bedtools">bedtools</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/index.html#ucsc-kent-source-utilities">UCSC kent source utilities</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/index.html#r-package-dependencies">R package dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/index.html#installing-the-rage-package-in-r">Installing the RAGE package in R</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../functions/bed.avglengths.html"><em>bed.avglengths</em></a><ul>
<li class="toctree-l2"><a class="reference internal" href="../functions/bed.avglengths.html#description">description</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/bed.avglengths.html#usage">usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/bed.avglengths.html#arguments">arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/bed.avglengths.html#output">output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/bed.avglengths.html#examples">examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../functions/bed.centers.html"><em>bed.centers</em></a><ul>
<li class="toctree-l2"><a class="reference internal" href="../functions/bed.centers.html#description">description</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/bed.centers.html#usage">usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/bed.centers.html#arguments">arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/bed.centers.html#output">output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/bed.centers.html#examples">examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../functions/bed.coverage.html"><em>bed.coverage</em></a><ul>
<li class="toctree-l2"><a class="reference internal" href="../functions/bed.coverage.html#description">description</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/bed.coverage.html#usage">usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/bed.coverage.html#arguments">arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/bed.coverage.html#output">output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/bed.coverage.html#examples">examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../functions/bed.genomecov.html"><em>bed.genomecov</em></a><ul>
<li class="toctree-l2"><a class="reference internal" href="../functions/bed.genomecov.html#description">description</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/bed.genomecov.html#usage">usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/bed.genomecov.html#arguments">arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/bed.genomecov.html#output">output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/bed.genomecov.html#examples">examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../functions/bed.intersect.html"><em>bed.intersect</em></a><ul>
<li class="toctree-l2"><a class="reference internal" href="../functions/bed.intersect.html#description">description</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/bed.intersect.html#usage">usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/bed.intersect.html#arguments">arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/bed.intersect.html#output">output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/bed.intersect.html#examples">examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../functions/bed.makewindows.html"><em>bed.makewindows</em></a><ul>
<li class="toctree-l2"><a class="reference internal" href="../functions/bed.makewindows.html#description">description</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/bed.makewindows.html#usage">usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/bed.makewindows.html#arguments">arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/bed.makewindows.html#output">output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/bed.makewindows.html#examples">examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../functions/bed.parselengths.html"><em>bed.parselengths</em></a><ul>
<li class="toctree-l2"><a class="reference internal" href="../functions/bed.parselengths.html#description">description</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/bed.parselengths.html#usage">usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/bed.parselengths.html#arguments">arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/bed.parselengths.html#output">output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/bed.parselengths.html#examples">examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../functions/bed.words.html"><em>bed.words</em></a><ul>
<li class="toctree-l2"><a class="reference internal" href="../functions/bed.words.html#description">description</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/bed.words.html#usage">usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/bed.words.html#arguments">arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/bed.words.html#output">output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/bed.words.html#examples">examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../functions/bg.map.html"><em>bg.map</em></a><ul>
<li class="toctree-l2"><a class="reference internal" href="../functions/bg.map.html#description">description</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/bg.map.html#usage">usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/bg.map.html#arguments">arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/bg.map.html#output">output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/bg.map.html#examples">examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../functions/gff.2.bg.html"><em>gff.2.bg</em></a><ul>
<li class="toctree-l2"><a class="reference internal" href="../functions/gff.2.bg.html#description">description</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/gff.2.bg.html#usage">usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/gff.2.bg.html#arguments">arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/gff.2.bg.html#output">output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/gff.2.bg.html#examples">examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../functions/hub.wig.html"><em>hub.wig</em></a><ul>
<li class="toctree-l2"><a class="reference internal" href="../functions/hub.wig.html#description">description</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/hub.wig.html#usage">usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/hub.wig.html#arguments">arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/hub.wig.html#output">output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/hub.wig.html#examples">examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../functions/mat.cor.html"><em>mat.cor</em></a><ul>
<li class="toctree-l2"><a class="reference internal" href="../functions/mat.cor.html#description">description</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/mat.cor.html#usage">usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/mat.cor.html#arguments">arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/mat.cor.html#output">output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/mat.cor.html#examples">examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../functions/mat.heatmap.html"><em>mat.heatmap</em></a><ul>
<li class="toctree-l2"><a class="reference internal" href="../functions/mat.heatmap.html#description">description</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/mat.heatmap.html#usage">usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/mat.heatmap.html#arguments">arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/mat.heatmap.html#output">output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/mat.heatmap.html#examples">examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../functions/mat.make.html"><em>mat.make</em></a><ul>
<li class="toctree-l2"><a class="reference internal" href="../functions/mat.make.html#description">description</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/mat.make.html#usage">usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/mat.make.html#arguments">arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/mat.make.html#value">value</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/mat.make.html#examples">examples</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../functions/mat.ops.html"><em>mat.ops</em></a><ul>
<li class="toctree-l2"><a class="reference internal" href="../functions/mat.ops.html#description">description</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/mat.ops.html#usage">usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/mat.ops.html#arguments">arguments</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/mat.ops.html#output">output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../functions/mat.ops.html#examples">examples</a></li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href=""><em>make matrices from microarray gffs</em></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#workflow">workflow</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">rage</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
    <li><em>make matrices from microarray gffs</em></li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../_sources/workflows/array.2.matrix.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="make-matrices-from-microarray-gffs">
<h1><em>make matrices from microarray gffs</em><a class="headerlink" href="#make-matrices-from-microarray-gffs" title="Permalink to this headline">¶</a></h1>
<p>In order to make matrices from microarray gffs, you should have the following:</p>
<ul class="simple">
<li>gffs of microarray data. This workflow assumes high-density (overlapping probes) data.</li>
<li>a bed file of genes or other genomic features you&#8217;d generate matrices from. If your genome is hosted on the UCSC genome browser, you can obtain a gene bed file from the table browser.</li>
</ul>
<div class="section" id="workflow">
<h2>workflow<a class="headerlink" href="#workflow" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Open R in your working directory of gffs and load rage.</li>
</ol>
<div class="highlight-r"><div class="highlight"><pre><span class="o">$</span> R
</pre></div>
</div>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> library<span class="p">(</span>devtools<span class="p">)</span>
<span class="o">&gt;</span> load_all<span class="p">(</span><span class="s">&quot;/data/rage&quot;</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>Make a vector of gff file names in current directory</li>
</ol>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> gffs <span class="o">&lt;-</span> files <span class="p">(</span><span class="s">&quot;*.gff&quot;</span><span class="p">)</span>
<span class="o">&gt;</span> gffs
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="s">&quot;z3b1c01.gff&quot;</span> <span class="s">&quot;z3b1c02.gff&quot;</span> <span class="s">&quot;z3b1c03.gff&quot;</span>
</pre></div>
</div>
<p>Here, &#8216;z3&#8217; is the name of the array design, &#8216;b1&#8217; specifies it is a first hyb, and &#8216;c01&#8217; specifies cycle 1 (subarray 1). Your microarray nomenclature may be different, but that&#8217;s OK.</p>
<ol class="arabic simple" start="3">
<li>Convert gffs to bedGraph files</li>
</ol>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> bgs <span class="o">&lt;-</span> lapply <span class="p">(</span> gffs <span class="p">,</span> gff.2.bg <span class="p">)</span>
<span class="o">&gt;</span> bgs
<span class="p">[[</span><span class="m">1</span><span class="p">]]</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="s">&quot;z3b1c01.bg&quot;</span>

<span class="p">[[</span><span class="m">2</span><span class="p">]]</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="s">&quot;z3b1c02.bg&quot;</span>

<span class="p">[[</span><span class="m">3</span><span class="p">]]</span>
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="s">&quot;z3b1c03.bg&quot;</span>
</pre></div>
</div>
<p>At this point you may want to check the distribution of probe scores with bg.hist. If gff intervals (probes) overlap at all, this breaks a rule in the bedGraph format, which specifies that no intervals should overlap.
One way around this is to create nonoverlapping windows of the probed regions and calculate the average probe score at each base pair with bg.map.
Here, we will make 1-bp windows at the microarray regions, then calculate the average score of all overlapping probes at each window.</p>
<ol class="arabic simple" start="4">
<li>Make 1-bp windows at 1-bp step size of the microarray regions. We can use any of the bedGraphs to grab the microarray regions, and will name the window bed &#8220;z3w1.bed&#8221; because my I&#8217;m making 1-bp windows from my &#8216;z3&#8217; array design.</li>
</ol>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> bed.makewindows <span class="p">(</span> bgs<span class="p">[[</span><span class="m">1</span><span class="p">]]</span> <span class="p">,</span> windowsize <span class="o">=</span> <span class="m">1</span> <span class="p">,</span> outname <span class="o">=</span> <span class="s">&quot;z3w1.bed&quot;</span> <span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li>Calculate average probe score at each base pair. We&#8217;ll also use unlist to convert the resulting list of file names into a vector so it will be compatible with mat.make later.</li>
</ol>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> windowedbgs <span class="o">&lt;-</span> unlist <span class="p">(</span> lapply <span class="p">(</span> bgs <span class="p">,</span> bg.map <span class="p">,</span> bedfile <span class="o">=</span> <span class="s">&quot;z3w1.bed&quot;</span> <span class="p">)</span> <span class="p">)</span>
<span class="o">&gt;</span> windowedbgs
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="s">&quot;z3b1c01_z3w1.bg&quot;</span> <span class="s">&quot;z3b1c02_z3w1.bg&quot;</span> <span class="s">&quot;z3b1c03_z3w1.bg&quot;</span>
</pre></div>
</div>
<p>At this point you have bedGraph files suitable for creating matrices and also for visualization on the UCSC genome browser.
We&#8217;ll only cover making matrices in this workflow.</p>
<p>6. To create a matrix of microarray scores at genes, we first want to prune out genes that are not covered on our microarray.
To prune our genes, we can intersect the gene bed with any bed or bedGraph file that is limited to our microarray probes.
This includes our bedGraph files in &#8216;bgs&#8217; or &#8216;windowsbgs&#8217; and our 1-base-pair window bed ( z3w1.bed ).
We&#8217;ll use our window bed to prune our gene list</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> arraygenes <span class="o">&lt;-</span> bed.intersect<span class="p">(</span> <span class="s">&quot;/path/to/genes.bed&quot;</span> <span class="p">,</span> <span class="s">&quot;z3w1.bed&quot;</span> <span class="p">)</span>
<span class="o">&gt;</span> arraygenes
<span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="s">&quot;genes_x_z3w1.bed&quot;</span>
</pre></div>
</div>
<p>Since the gene name will be appended to all of our matrices, let&#8217;s make the gene name prettier.</p>
<div class="highlight-r"><div class="highlight"><pre>system <span class="p">(</span><span class="s">&quot;mv genes_x_z3w1.bed z3genes.bed&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>7. Now create matrices of our bedGraphs aligned at the TSSs of our array genes. We will use the default parameters for regionsize (2000 bp) and windowsize (10 bp).
We want to use bgfiller = &#8220;NA&#8221; so that regions not covered by probes are not artificially assigned zeroes.
We want to use featurecenter = FALSE because we want to align at the 5&#8217; end of the gene intervals (TSSs) and not the midpoints of genes.
We want to use strand = TRUE because we want to use the rightmost boundaries in our gene bed as the alignment point for minus-stranded genes.</p>
<div class="highlight-r"><div class="highlight"><pre><span class="o">&gt;</span> mat.make <span class="p">(</span> windowedbgs <span class="p">,</span> arraygenes <span class="p">,</span> strand <span class="o">=</span> <span class="kc">TRUE</span> <span class="p">,</span> bgfiller <span class="o">=</span> <span class="s">&quot;NA&quot;</span> <span class="p">,</span> featurecenter <span class="o">=</span> <span class="kc">FALSE</span> <span class="p">)</span>
</pre></div>
</div>
<p>Your matrices will be saved to a directory named &#8220;arraygenes_mat10&#8221;.</p>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="../functions/mat.ops.html" class="btn btn-neutral" title="mat.ops"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, Daniel Vera.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-50602521-1', 'github.com');
  ga('send', 'pageview');

</script>


</body>
</html>